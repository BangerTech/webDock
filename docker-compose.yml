services:
  webdock-ui:
    container_name: webdock-ui
    build: .
    ports:
      - "8585:80"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - /usr/bin/docker:/usr/bin/docker:ro
      - /usr/libexec/docker/cli-plugins/docker-compose:/usr/libexec/docker/cli-plugins/docker-compose:ro
      - ${PWD}/../..:/app/webdock
      - ${PWD}/../../docker-templates:/app/docker-templates
      - ${PWD}/../../docker-compose-data/config:/app/data/config
      - ./src/static/img:/app/static/img
    environment:
      - DOCKER_HOST=unix:///var/run/docker.sock
      - FLASK_DEBUG=1
      - FLASK_ENV=development
      - CONFIG_DIR=/app/data/config
      - WEBDOCK_BASE_PATH=/app/webdock
      - COMPOSE_FILES_DIR=/app/docker-templates
      - COMPOSE_DATA_DIR=/app/webdock/docker-compose-data
    restart: unless-stopped
    networks:
      - webdock-network

volumes:
  host-config:

networks:
  webdock-network:
    external: true
